{% extends 'base.html' %}
{% load staticfiles %}
{% block body_block %}
{% load tz %}
{% localtime on %}
<body class="body">
<div class="main" style="margin: 20px">
    <table id="example" class="display compact order-column stripe row-border" style="width:100%">
        <thead>
            <tr>
                <th>Name</th>
                <th>Team</th>
                <th>H/A</th>
                <th>Throws</th>
                <th>Sal</th>
                <th>Ave</th>
                <th>ERA</th>
                <th>WHIP</th>
                <th>Kp 9</th>
                <th>HRp 9</th>
                <th>K%</th>
                <th>OPP</th>
                <th>OPP K%</th>
                <th>OPP ISO</th>
                <th>OPP wOBA</th>
                <th>Park Runs</th>
                <th>Park HR</th>
                <th>Pfx</th>
                <th>SwStr%</th>
                <th>Soft</th>
                <th>Hard</th>
                <th>FB</th>
                <th>GB</th>
            </tr>
        </thead>
        <tbody>
        {% if pitchers %}
        {% for p in pitchers %}
            <tr>
                <td>{{ p.dk_name }}</td>
                <td>{{ p.Team }}</td>
                <td>{{ p.Home }}</td>
                <td>{{ p.throws }}</td>
                <td>{{ p.salary }}</td>
                <td>{{ p.avg }}</td>
                <td>{{ p.era }}</td>
                <td>{{ p.whip }}</td>
                <td>{{ p.kk_p9 }}</td>
                <td>{{ p.hr_p9 }}</td>
                <td>{{ p.kp }}</td>
                <td>{{ p.opp }}</td>
                <td>{{ p.OPP_K }}</td>
                <td>{{ p.OPP_ISO }}</td>
                <td>{{ p.OPP_wOBA }}</td>
                <td>{{ p.park_runs }}</td>
                <td>{{ p.park_hr }}</td>
                <td>{{ p.Pfx }}</td>
                <td>{{ p.swstr }}</td>
                <td>{{ p.soft }}</td>
                <td>{{ p.hard }}</td>
                <td>{{ p.fb }}</td>
                <td>{{ p.gb }}</td>
            </tr>
        {% endfor %}
        {% endif %}
        </tbody>
        <tfoot>
            <tr>
                <th>Name</th>
                <th>Team</th>
                <th>H/A</th>
                <th>Throws</th>
                <th>Sal</th>
                <th>Ave</th>
                <th>ERA</th>
                <th>WHIP</th>
                <th>Kp 9</th>
                <th>HRp 9</th>
                <th>K%</th>
                <th>OPP</th>
                <th>OPP K%</th>
                <th>OPP ISO</th>
                <th>OPP wOBA</th>
                <th>Park Runs</th>
                <th>Park HR</th>
                <th>Pfx</th>
                <th>SwStr%</th>
                <th>Soft</th>
                <th>Hard</th>
                <th>FB</th>
                <th>GB</th>
            </tr>
        </tfoot>
    </table>
</div>
</body>

<script type="text/javascript" charset="utf8">
    $(document).ready(function() {
        $('#example').dataTable( {
            paging: false
        } );

        function opacityGetter(avg, std, low, val) {
            var diff = val - avg
            var opac = Math.abs((diff / std) / 2.5)
            if ( opac > 1 ) {
                opac = 1;
            };
            if ( diff > 0 && low ) {
                var color = 'rgba(255,0,0,' + opac + ')'
            } elif ( diff <= 0 && low ) {
                var color = 'rgba(0,255,0,' + opac + ')'
            } elif ( diff > 0 && !low ) {
                var color = 'rgba(0,255,0,' + opac + ')'
            } else {
                var color = 'rgba(0,255,0,' + opac + ')'
            }
            return color;
        };

        var cols = {{ cols|safe }};

        for (var i = 0; i < cols.length; i++) {
            var avg = cols[i].avg;
            var std = cols[i].std;
            var col = cols[i].numb;
            var low = cols[i].low;
            console.log(avg);
            console.log(std);
            console.log(col);
            console.log(low);

            $('table td:nth-child(' + col + ')').each(function() {
                var val = $(this).text();
                var color = opacityGetter(avg, std, low, val)
                console.log(color)
                $(this).css('backgroundColor', color);
            });

        }

    } );
</script>
{% endlocaltime %}
{% endblock %}